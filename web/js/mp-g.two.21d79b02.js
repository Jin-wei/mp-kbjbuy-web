app.controller("loginController",["$rootScope","$scope","$location","$httpService","$hostService","$filter",function(a,b,c,d,e,f){function g(b){d.get(e.bizApi+"/custs/"+b+"/biz").then(function(b){if(b.success){InfoBox("登录成功!"),b.result?null==b.result.bizId?d.setCookie(d.BIZ_ID,0):(d.setCookie(d.BIZ_ID,b.result.bizId),d.setCookie(d.BIZ_NAME,b.result.bizName)):d.setCookie(d.BIZ_ID,0);var e=c.search().whereCome;null!=e&&"any"!=e?window.setTimeout(function(){window.location="indexApp.html#/"+e},100):a.toHome()}else WarningBox(b.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}a.headerSearch=0,a.headerNav=0,b.saveCheck=!0,initHeaer(),"true"==d.getCookie(d.REMEBER_PWD)?(b.saveCheck=!0,null!=d.getCookie(d.USER_PHONE)&&(b.account=d.getCookie(d.USER_PHONE),b.password=d.getCookie(d.USER_PWD))):(b.saveCheck=!1,b.account="",b.password=""),b.loginClick=function(){var c=b.saveCheck;if(d.setCookie(d.REMEBER_PWD,c),null==b.account||""==b.account)WarningBox("请输入手机号!");else if(null==b.password||""==b.password)WarningBox("请输入密码!");else{var f;f=b.account.indexOf("@")>0?{method:"emailpassword",email:b.account,phone:"",password:b.password}:{method:"phonepassword",phone:b.account,password:b.password},d.post(e.loginApi+"/auth/tokens",f).then(function(c){c.success?(d.setCookie(d.COMMON_AUTH_NAME,c.result.accessToken),d.setCookie(d.USER_ID,c.result.user.userId),d.setCookie(d.USER_NAME,c.result.user.name),d.setCookie(d.CITY,c.result.user.city),d.setCookie(d.USER_PHONE,b.account),d.setCookie(d.USER_PWD,b.password),d.setHeader("auth-token",d.getCookie(d.COMMON_AUTH_NAME)),g(c.result.user.userId),d.setCookie("isLogin","1"),d.setCookie("username",c.result.user.name),a.userName=d.getCookie("username"),a.isLogin=!0):WarningBox(c.msg)}).catch(function(a){d.setCookie("isLogin","0"),"NotAuthorized"!=a.code?ErrorBox("服务器内部错误"):WarningBox("用户名或密码错误!")})}},baiduLinkSubmit(),$(function(){setPageTitle("登陆","","")})}]),app.controller("registerController",["$rootScope","$scope","$httpService","$hostService","L","$filter",function(a,b,c,d,e,f){function g(a){c.get(d.bizApi+"/custs/"+a+"/biz").then(function(a){a.success?a.result?null==a.result.bizId?c.setCookie(c.BIZ_ID,0):(c.setCookie(c.BIZ_ID,a.result.bizId),c.setCookie(c.BIZ_NAME,a.result.bizName)):c.setCookie(c.BIZ_ID,0):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}a.headerSearch=0,a.headerNav=0;var h=60;initHeaer(),b.sendCode=function(){if(null==b.name||""==b.name)WarningBox("请输入用户名!");else if(null==b.phone||""==b.phone)WarningBox("请输入手机号!");else{if(60==h){var a={smsType:"registeruser",phone:b.phone};c.post(d.loginApi+"/sms/captcha",a).then(function(a){a.success?(InfoBox("验证码发送成功,请注意查收!"),b.code=a.id):(WarningBox(a.msg),h=0)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}0==h?(document.getElementById("codeBtn").disabled=!1,document.getElementById("codeBtn").innerHTML="发送验证码",h=60):(document.getElementById("codeBtn").disabled=!0,document.getElementById("codeBtn").innerHTML="重新发送("+h+")",h--,setTimeout(function(){b.sendCode()},1e3))}},b.registerClick=function(){if(null==b.identity||""==b.identity)return void WarningBox("请选择用户身份!");if(null==b.name||""==b.name)return void WarningBox("请输入用户名!");if((null==b.phone||""==b.phone)&&1==b.RegisterType)return void WarningBox("请输入手机号!");if((null==b.code||""==b.code)&&1==b.RegisterType)return void WarningBox("请输入验证码!");if((null==b.email||""==b.email)&&2==b.RegisterType)return void WarningBox("请输入邮箱!");if(null==b.password||""==b.password)return void WarningBox("请输入密码!");if(b.password.length<6)return void WarningBox("请输入6位以上的密码!");if(b.passwordConfirm!=b.password)return void WarningBox("两次输入密码不一致");var f;f=1==b.RegisterType?{method:"phonepassword",att1String:b.identity,name:b.name,phone:b.phone,password:b.password,code:b.code}:{method:"emailpassword",att1String:b.identity,name:b.name,password:b.password,email:b.email},c.post(d.loginApi+"/registeredusers",f).then(function(d){if(d.success)1==b.RegisterType?(InfoBox("恭喜您,注册成功!"),c.setCookie(c.COMMON_AUTH_NAME,d.result.accessToken),c.setCookie(c.USER_ID,d.result.user.userId),c.setCookie(c.USER_NAME,d.result.user.name),c.setCookie(c.CITY,d.result.user.city),c.setHeader("auth-token",c.getCookie(c.COMMON_AUTH_NAME)),c.setCookie("isLogin","1"),c.setCookie("username",d.result.user.name),a.userName=c.getCookie("username"),a.isLogin=!0,g(d.result.user.userId),a.toHome()):InfoBox("恭喜您,注册成功!请到邮箱激活账号");else{var f=e.L(d.msg);WarningBox(f)}}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},b.RegisterType=1,b.clickRegisterType=function(){1==b.RegisterType?b.RegisterType=2:b.RegisterType=1},$(function(){baiduLinkSubmit(),setPageTitle("注册","","")})}]),app.controller("forgottenPasswordController",["$scope","$httpService","$hostService","$rootScope","$filter",function(a,b,c,d,e){var f=60;initHeaer(),a.sendCode=function(){if(null==a.phone||""==a.phone)WarningBox("请输入手机号!");else{if(60==f){var d={smsType:"resetpassword",phone:a.phone};b.post(c.loginApi+"/sms/captcha",d).then(function(b){b.success?(InfoBox("验证码发送成功,请注意查收!"),a.code=b.id):(WarningBox(b.msg),f=0)}).catch(function(a){"NotAuthorized"!=a.code&&"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}0==f?(document.getElementById("codeBtn").disabled=!1,document.getElementById("codeBtn").innerHTML="发送验证码",f=60):(document.getElementById("codeBtn").disabled=!0,document.getElementById("codeBtn").innerHTML="重新发送("+f+")",f--,setTimeout(function(){a.sendCode()},1e3))}},a.submit=function(){if(null==a.phone||""==a.phone)WarningBox("请输入手机号!");else if(null==a.code||""==a.code)WarningBox("请输入验证码!");else if(null==a.password||""==a.password)WarningBox("请输入密码!");else{var e={method:"phone",phone:a.phone,password:a.password,code:parseInt(a.code)};b.post(c.loginApi+"/passwords",e).then(function(a){a.success?(InfoBox("恭喜您,重置密码成功,请重新登录!"),d.toHome()):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}},$(function(){setPageTitle("修改手机号","","")})}]),app.controller("changePhoneController",["$scope","$httpService","$hostService","$filter",function(a,b,c,d){var e=b.getCookie(b.USER_ID);if(initHeaer(),null==e||0==e.length){if(configLogin(d,"changePhone"))return}var f=60;a.sendCode=function(){if(null==a.oldPhone||""==a.oldPhone)WarningBox("请输入原手机号!");else if(null==a.newPhone||""==a.newPhone)WarningBox("请输入新手机号!");else{if(60==f){var d={smsType:"changephone",phone:a.newPhone};b.post(c.loginApi+"/sms/captcha",d).then(function(b){b.success?(InfoBox("验证码发送成功,请注意查收!"),a.code=b.id):(WarningBox(b.msg),f=0)}).catch(function(a){"NotAuthorized"!=a.code&&"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}0==f?(document.getElementById("codeBtn").disabled=!1,document.getElementById("codeBtn").innerHTML="发送验证码",f=60):(document.getElementById("codeBtn").disabled=!0,document.getElementById("codeBtn").innerHTML="重新发送("+f+")",f--,setTimeout(function(){a.sendCode()},1e3))}},a.submit=function(){if(null==a.oldPhone||""==a.oldPhone)WarningBox("请输入原手机号!");else if(null==a.newPhone||""==a.newPhone)WarningBox("请输入新手机号!");else if(null==a.code||""==a.code)WarningBox("请输入验证码!");else{var d={phone:a.newPhone,code:parseInt(a.code)},e=b.getCookie(b.USER_ID);b.put(c.loginApi+"/users/"+e+"/phones",d).then(function(a){a.success?(InfoBox("恭喜您,手机号修改成功,请重新登录!"),logOut()):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}},$(function(){setPageTitle("找回密码","","")})}]),app.controller("homeController",["$rootScope","$scope","$httpService","$hostService","$filter",function(a,b,c,d,e){function f(){c.get(d.productApi+"/favoriteProds").then(function(a){a.success?b.collections=a.result:WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function g(){c.get(d.productApi+"/biz/0/tags/2/prods").then(function(a){a.success?(b.bannerList=a.result,h(a.result)):WarningBox(a.msg)}).catch(function(a){ErrorBox("获取banner列表服务器内部错误")})}function h(a){for(var e=0;e<a.length;e++){var f=a[e];c.get(d.productApi+"/biz/"+f.bizId+"/prods/"+f.prodId).then(function(a){if(a.success){if(null!=a.result.images&&a.result.images.length>0)for(var c=0;c<a.result.images.length;c++){var d=a.result.images[c];"banner"==d.img_type&&(b.bannerImgUrl.push(a.result.images[c].img_url),console.log(b.bannerImageService+a.result.images[c].img_url))}}else WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}}a.headerSearch=0,a.headerNav=0,b.category=[],b.recommeds=[],b.bannerList=[],b.bannerImgUrl=[],b.imageService=d.imageApi+"/sizes/m/imageSets/",b.bannerImageService=d.imageApi+"/images/",initHeaer(),b.categoryClick=function(a){console.log("商品分类Id="+a),window.location.href="indexApp.html#/product_filter/"+a+"/type/1"},c.get(d.productApi+"/tags/1/prodTypes").then(function(a){if(b.category=[],a.result.length>9)for(var c=0;c<9;c++)b.category.push(a.result[c]);else b.category=a.result}).catch(function(a){"NotAuthorized"!=error.code&&ErrorBox("服务器内部错误")}),c.get(d.productApi+"/biz/0/tags/1/prods").then(function(a){a.success?b.recommeds=a.result.slice(0,20):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=error.code&&ErrorBox("服务器内部错误")}),a.imageSize=function(a){return d.imageApi+"/sizes/"+a+"/imageSets/"};var i=0,j=0;window.onscroll=function(){i=window.scrollY,j=window.scrollX},b.addCollectionClick=function(a){var e={prods:[a.prodId]};c.post(d.productApi+"/favoriteProds",e).then(function(c){c.success?c.result.length>0?c.result[0].success?(b.collections.push(a),Toast("已添加到收藏!")):WarningBox("当前商品已经收藏,请到我的收藏里查看!"):WarningBox("添加收藏失败!"):WarningBox(c.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},b.deleteCollectionClick=function(a){var b={prods:[a.prodId]};c.delete(d.productApi+"/favoriteProds",{data:b}).then(function(a){a.success?f():WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},b.ifHasInFavorite=function(a){var c=!1;for(var d in b.collections){b.collections[d].prodId==a&&(c=!0)}return c},b.addShoppingCartClick=function(c,d,e,f){a.prodPush(c,d);var g="#add-cart-btn"+e,h=$(g).offset(),k=a.staticContentURL+"/"+a.tenant+"/assets/images/prodDefault240.jpg";null!=c.imgUrl&&c.imgUrl.length>0&&(k=b.imageService+c.imgUrl);var l=$('<img class="u-flyer" src="'+k+'">');l.css({width:"50px",height:"50px"}),l.fly({start:{left:h.left-j+30,top:h.top-i},end:{left:a.cartOffset.left+10,top:a.cartOffset.top+10,width:0,height:0},onEnd:function(){this.destory()}})},b.bannerLinkToProduct=function(a){var c=b.bannerList[a];c&&(window.location.href="indexApp.html#/product/"+c.prodId+"/bizId/0")},baiduLinkSubmit(),$(function(){g(),checkPlatform(),setPageTitle("","",""),window.setTimeout(function(){OwlCarousel.initOwlCarousel()},1e3)})}]),app.controller("productFilterController",["$httpService","$hostService","$scope","$rootScope","$location","$filter","$routeParams",function(a,b,c,d,e,f,g){function h(c,d,e){var f=b.productApi+"/biz/0/prodTypes";a.get(f).then(function(a){if(a){var b=a.result,f={};for(var g in b)b[g].typeId==c&&1==e&&(f=b[g]);d.length>0&&2==e?(f.name=c,f.nameLang=""):d.length>0&&3==e?(f.name=d[0].type,f.nameLang=d[0].typeLang):0==d.length&&1!=e?f.name=c:0==d.length&&1==e&&(f.name="产品分类"),f?f.description?setPageTitle(f.name+"",f.description,f.name+(f.nameLang?","+f.nameLang:"")):setPageTitle(f.name+"",f.name,f.name+(f.nameLang?","+f.nameLang:"")):setPageTitle("","","")}}).catch(function(a){"NotAuthorized"!=error.code&&ErrorBox("服务器内部错误")})}function i(){a.get(b.productApi+"/favoriteProds").then(function(a){a.success?c.collections=a.result:WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}d.headerSearch=0,d.headerNav=0,c.products=[],c.collections=[],c.bizId=0,c.imageService=b.imageApi+"/sizes/m/imageSets/",c.searchText=g.typeId,c.searchType=g.type,c.startIndex=0,c.size=20,c.hasMore=!0;var j=!1;a.getCookie(a.USER_ID),a.getCookie(a.BIZ_ID);initHeaer(),c.loadMore=function(){if(c.hasMore&&!j){j=!0;var d;"1"===c.searchType?d=b.productApi+"/biz/0/prodTypes/"+c.searchText+"/prods?active=1&start="+c.startIndex+"&size="+c.size:"3"===c.searchType?d=b.productApi+"/prodSearchNca?name="+c.searchText+"&active=1&start="+c.startIndex+"&size="+c.size:"2"===c.searchType&&(d=b.productApi+"/prodSearch/"+c.searchText+"?active=1&start="+c.startIndex+"&size="+c.size),a.get(d).then(function(a){if(j=!1,a.success){var b=[];b="1"===c.searchType||"3"===c.searchType?a.result:a.result.hits;for(var d=0;d<b.length;d++){var e=b[d]._source?b[d]._source:b[d];c.products.push(e)}0==c.startIndex&&h(c.searchText,b,c.searchType),b.length>=c.size?(c.startIndex+=c.size,c.hasMore=!0):(c.startIndex+=b.length,c.hasMore=!1)}else WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误"),c.hasMore=!0,j=!1})}};var k=0;window.onscroll=function(){k=window.scrollY},c.addShoppingCartClick=function(a,b,e,f){d.prodPush(a,b);var g="#add-cart-btn"+e,h=$(g).offset(),i=d.staticContentURL+"/"+d.tenant+"/assets/images/prodDefault240.jpg";null!=a.imgUrl&&a.imgUrl.length>0&&(i=c.imageService+a.imgUrl);var j=0,l=0;"栅格"==f?(j=h.left+30,l=h.top-5-k):(j=h.left+20,l=h.top-k);var m=$('<img class="u-flyer" src="'+i+'">');m.css({width:"50px",height:"50px"}),m.fly({start:{left:j,top:l},end:{left:d.cartOffset.left+10,top:d.cartOffset.top+10,width:0,height:0},onEnd:function(){this.destory()}})},c.addCollectionClick=function(d){var e={prods:[d.prodId]};a.post(b.productApi+"/favoriteProds",e).then(function(a){a.success?a.result.length>0?a.result[0].success?(c.collections.push(d),Toast("已添加到收藏!")):WarningBox("当前商品已经收藏,请到我的收藏里查看!"):WarningBox("添加收藏失败!"):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},c.deleteCollectionClick=function(c){var d={prods:[c.prodId]};a.delete(b.productApi+"/favoriteProds",{data:d}).then(function(a){a.success?i():WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},c.gotoDetail=function(a,b){window.location.href="indexApp.html#/product/"+a+"/bizId/"+b},c.ifHasInFavorite=function(a){var b=!1;for(var d in c.collections){c.collections[d].prodId==a&&(b=!0)}return b};var l=a.getCookie(a.COMMON_AUTH_NAME);null!=l&&""!==l&&l&&i(),baiduLinkSubmit()}]),app.controller("productDetailController",["$scope","$rootScope","$location","$anchorScroll","$httpService","$hostService","sharedData","$filter","$routeParams",function(a,b,c,d,e,f,g,h,i){function j(){e.get(f.productApi+"/biz/"+n+"/prods/"+m+"/prodComments?start="+p+"&size="+(q+1)).then(function(b){if(null!=b.result){if(!(b.result instanceof Array))return;if(0==b.result.length)return;p>=q?$("#preBtn").attr("disabled",!1):$("#preBtn").attr("disabled",!0),b.result.length<q+1?($("#nextBtn").attr("disabled",!0),r=!1):($("#nextBtn").attr("disabled",!1),r=!0),o.splice(0,o.length),o=b.result.slice(0,q);for(var c=0;c<o.length;c++){var d=o[c],e=new Date(d.createTime),f=e.toLocaleString();d.createTime=f}a.nowReviews=o}else WarningBox(b.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function k(b){e.get(f.productApi+"/biz/"+n+"/prodTypes/"+b+"/prods?start=0&size=10").then(function(b){if(b){a.relevantProduct=[];for(var c=0;c<b.result.length;c++)b.result[c].prodId!=m&&a.relevantProduct.push(b.result[c])}else WarningBox(b.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function l(){e.get(f.productApi+"/favoriteProds").then(function(b){b.success?a.collections=b.result:WarningBox(b.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}a.MimageService=f.imageApi+"/sizes/m/imageSets/",n=0;initHeaer(),window.setTimeout(function(){$("html, body").animate({scrollTop:0},0)},100);var m=c.search().productId,n=c.search().biz_id?c.search().biz_id:0;i.productId&&(m=i.productId,n=i.bizId);e.getCookie(e.USER_ID),e.getCookie(e.BIZ_ID);a.descriptionImage=[],a.collections=[],a.fileData=[],e.get(f.productApi+"/biz/"+n+"/prods/"+m).then(function(b){if(b.success){a.productData=b.result,a.productData.num=1;var c=[];if(null!=b.result.images&&b.result.images.length>0)for(var d=0;d<b.result.images.length;d++){var e=b.result.images[d];if("cover"==e.img_type){var g=f.imageApi+"/sizes/l/imageSets/"+b.result.images[d].img_url,h=f.imageApi+"/sizes/m/imageSets/"+b.result.images[d].img_url;c.push({bigImgUrl:g,smallImgUrl:h,description:b.result.images[d].description})}else if("description"==e.img_type){var i=f.imageApi+"/images/"+e.img_url;a.descriptionImage.push({url:i,description:b.result.images[d].description})}else if("file"==e.img_type){var i=f.imageApi+"/images/"+e.img_url;a.fileData.push(i)}}else c.push({bigImgUrl:"../assets/images/no_img.png",smallImgUrl:"../assets/images/no_img_s.png"});a.imageArr=c,window.setTimeout(function(){MasterSliderShowcase2.initMasterSliderShowcase2()},300);var j=(a.productData.productName?a.productData.productName:"")+(a.productData.prodCode?","+a.productData.prodCode:"")+(a.productData.type?","+a.productData.type:"")+(a.productData.measurement?","+a.productData.measurement:"");null!==a.productData.description?setPageTitle(a.productData.productName+"",a.productData.description,j):b.result==[]?setPageTitle("产品描述",a.productData.productName,j):setPageTitle(a.productData.productName+"",a.productData.productName,j),k(b.result.typeId),a.fileData.length>0&&a.showFileButton()}else WarningBox(b.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")}),a.addCollectionClick=function(b){var c={prods:[b.prodId]};e.post(f.productApi+"/favoriteProds",c).then(function(c){c.success?c.result.length>0?c.result[0].success?(a.collections.push(b),Toast("已添加到收藏!")):WarningBox("当前商品已经收藏,请到我的收藏里查看!"):WarningBox("添加收藏失败!"):WarningBox(c.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},a.deleteCollectionClick=function(a){var b={prods:[a.prodId]};e.delete(f.productApi+"/favoriteProds",{data:b}).then(function(a){a.success?l():WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})};var o=[],p=0,q=10,r=!1;$("#preBtn").attr("disabled",!0),j(),a.previousPageClick=function(){p>=q&&(p-=q,j())},a.nextPageClick=function(){r&&(p+=q,j())},a.increaseClick=function(){a.productQuantity>1&&a.productQuantity--,a.productData.num=a.productQuantity},a.plusClick=function(){a.productQuantity++,a.productData.num=a.productQuantity},a.changeNum=function(){console.log(a.productQuantity)},a.addShoppingCartClick=function(c,d){a.productQuantity>200&&(a.productQuantity=200,WarningBox("购买的最大数量为200")),b.prodPush(c,a.productQuantity);var e=$("#add-cart-btn").offset(),f=b.staticContentURL+"/"+b.tenant+"/assets/images/prodDefault240.jpg";null!=c.imgUrl&&c.imgUrl.length>0&&(f=a.MimageService+c.imgUrl);var g=$('<img class="u-flyer" src="'+f+'">');g.css({width:"50px",height:"50px"}),g.fly({start:{left:e.left,top:e.top},end:{left:b.cartOffset.left+10,top:b.cartOffset.top+10,width:0,height:0},onEnd:function(){this.destory()}})},a.activeTab=1,a.descriptionClick=function(b){a.activeTab=b},a.goto=function(b){a.activeTab=2,window.setTimeout(function(){c.hash(b),d()},10)},a.backToType=function(a){window.location.href="indexApp.html#/product_filter/"+a+"/type/1"},a.ifHasInFavorite=function(b){var c=!1;for(var d in a.collections){a.collections[d].prodId==b&&(c=!0)}return c},null!=e.getCookie(e.COMMON_AUTH_NAME)&&l(),a.addShoppingCartTodyClick=function(c,d,e){b.prodPush(c,d);var f="#add-cart-btn"+e,g=$(f).offset(),h=b.staticContentURL+"/"+b.tenant+"/assets/images/prodDefault240.jpg";null!=c.imgUrl&&c.imgUrl.length>0&&(h=a.imageService+c.imgUrl);var i=$('<img class="u-flyer" src="'+h+'">');i.css({width:"50px",height:"50px"}),i.fly({start:{left:g.left-scrollX+30,top:g.top-scrollY},end:{left:b.cartOffset.left+10,top:b.cartOffset.top+10,width:0,height:0},onEnd:function(){this.destory()}})},a.toSearch=function(a){window.location.href="indexApp.html#/product_filter/"+a+"/type/3"},a.setue4=function(){$(document.body).append('<script>"object"==typeof ue&&"object"==typeof ue.interface&&function(e){"function"==typeof e.broadcast&&(ue.interface={},ue.interface.broadcast=function(t,a){void 0!==a?e.broadcast(t,JSON.stringify(a)):e.broadcast(t,"")},ue4=ue.interface.broadcast)}(ue.interface);<\/script>')},a.downPakFIle=function(a){ue4("volume",a)},a.showFileButton=function(){var b=g.getZyUser(b)?g.getZyUser(b):null;"zy"===b?(a.pakFileButtonShow=!0,a.setue4()):a.pakFileButtonShow=!1},baiduLinkSubmit()}]),app.controller("shoppingcartController",["$scope","$rootScope","$httpService","$hostService","$filter",function(a,b,c,d,e){b.headerSearch=1,b.headerNav=1,initHeaer(),a.clickAllSelected=function(){$("#selectAll").attr("checked")?$("[name='productBox']").removeAttr("checked"):$("[name='productBox']").attr("checked","true")},a.goPay=function(){var a=c.getCookie(c.USER_ID),b={orderId:1,bizId:1,userId:a,orderAmount:500,orderQuantity:5,items:[{id:1,orderId:1,productId:4,productName:"咖啡豆",amount:50,quantity:2,unitPrice:25}]};c.post(d.orderApi+"/user/"+a+"/order",b).then(function(a){a.success?(InfoBox("创建订单成功!"),window.location.href="indexApp.html#/orderInfo"):(console.log(a),WarningBox(a.message))}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},baiduLinkSubmit()}]),app.controller("orderInfoController",["$scope","$rootScope","$httpService","$hostService","$interval","$location","$filter",function(a,b,c,d,e,f,g){function h(){1==a.step?a.stepDescription="检验 & 编辑你的产品":2==a.step?a.stepDescription="航运和地址":a.stepDescription="请选择支付方式"}function j(){var b=[];$("input:checkbox[name=checkboxId]:checked").each(function(a){var c=JSON.parse($(this).val());b.push(c)}),a.selectItems=b}function k(){c.getCookie("isLogin")&&c.get(d.bizApi+"/custs/"+s+"/customerprices?bizId="+t).then(function(c){if(c.success){if(a.carts)for(var d=0;d<a.carts.length;d++)for(var e=0;e<c.result.length;e++)a.carts[d].id==c.result[e].prodId&&b.updateSpecialPrice(a.carts[d].id,c.result[e].price);v||(a.selectItems=a.carts),r()}else WarningBox(c.message)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function l(a){var e={orderStatus:"confirmed",statusMsg:"货到付款"};c.post(d.orderApi+"/users/"+s+"/orders/"+y+"/status",e).then(function(a){a.success&&(InfoBox("您的订单已经被商家接受,请耐心等待!"),b.clearCart(),b.toHome())}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function m(){for(var b=[],e=0;e<a.selectItems.length;e++){var f=0;f=-1!=a.selectItems[e].specialPrice&&null!=a.selectItems[e].specialPrice?a.selectItems[e].specialPrice:a.selectItems[e].price;var g={productId:a.selectItems[e].id,productName:a.selectItems[e].name,quantity:a.selectItems[e].num,unitPrice:f,productCode:a.selectItems[e].productCode,supplierId:a.selectItems[e].supplierId,supplierName:a.selectItems[e].supplierName,unitOfMeasure:a.selectItems[e].unitOfMeasure};b.push(g)}if(a.subtotal<38){var g={productId:"0",productName:"shipping",quantity:1,unitPrice:.01,productCode:"",supplierId:"",supplierName:""};b.push(g)}var i=c.getCookie(c.BIZ_NAME),j={orders:[{bizId:t,bizName:i,name:a.address.name,phone:a.address.phone,address:a.address.address,city:a.address.city,state:a.address.state,zipcode:"",note:a.note?a.note:"",items:b}]};c.setHeader("auth-token",c.getCookie(c.COMMON_AUTH_NAME)),c.post(d.orderApi+"/users/"+s+"/orders",j).then(function(b){null!=b.result&&b.result.length>0?b.result[0].success&&(y=b.result[0].id,a.step++,h(),InfoBox("创建订单成功!")):(console.log(b),WarningBox(b.msg))}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function n(a){return!!/^((1)+\d{10})$/.test(a)}function o(){c.get(d.orderApi+"/users/"+s+"/addresses").then(function(b){if(b.success){for(var c=0;c<b.result.length;c++)b.result[c].edit=!1;a.addressArr=b.result}}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function p(b){var c=null;for(i in a.selectItems){var d=a.selectItems[i];b.id==d.id&&(c=i)}c&&a.selectItems.splice(parseInt(c),1)}function q(b,c){for(index in a.selectItems){var d=a.selectItems[index];d.id==b&&(d.num=c)}}function r(){if(a.selectItems){for(var b=0,c=0;c<a.selectItems.length;c++)-1!=a.selectItems[c].specialPrice&&null!=a.selectItems[c].specialPrice?b+=a.selectItems[c].specialPrice*a.selectItems[c].num:b+=a.selectItems[c].price*a.selectItems[c].num;a.subtotal=b.toFixed(2),a.freight=b>=38?0:b>0?10:0,a.total=(b+a.freight).toFixed(2)}}var s="",t="",u=f.search().reOrderItems,v=u?JSON.parse(u):null;if(a.selectItems=[],initHeaer(),s=c.getCookie(c.USER_ID),t=c.getCookie(c.BIZ_ID),null==s||0==s.length||null==t||0==t.length)return void(window.location.href="indexApp.html#/login?whereCome=orderInfo");if(v)for(index in v){var w=v[index],x={};x.prodId=w.productId,x.id=w.productId,x.productName=w.productName,x.name=w.productName,x.price=w.unitPrice,x.imgUrl=w.imgUrl?w.imgUrl.split("/").slice(-1)[0]:null,x.special_price=w.unitPrice,x.specialPrice=w.unitPrice,x.productCode=w.productCode,x.supplierId=w.bizId,x.supplierName=w.supplierName,x.unitOfMeasure=w.unitOfMeasure,x.num=w.quantity,b.prodPush(x,w.quantity),a.selectItems.push(x)}else a.selectItems=a.carts;a.imageService=d.imageApi+"/sizes/m/imageSets/",b.$watch("carts",function(c){null!=b.carts&&b.carts.length>0?(a.haveProduct=1,k()):a.haveProduct=0}),a.step=1,a.stepDescription="检验 & 编辑你的产品",a.stepBack=function(){a.step--,h()},a.validateCheck=function(b){var c=!1;for(index in a.selectItems){var d=a.selectItems[index];if(b.id==d.id){c=!0;break}}return c},a.selectClick=function(){j(),r()};var y=0;a.stepForward=function(){1==a.step?a.step++:2==a.step?(c.get(d.orderApi+"/users/"+s+"/addresses").then(function(b){if(b.success)if(b.result.length>0){var c=!1;if(1==b.result.length)a.address=b.result[0],m();else{for(var d=0;d<b.result.length;d++)if(1==b.result[d].primaryFlag){a.address=b.result[d],c=!0;break}c?m():WarningBox("请选择一个地址使用!")}}else WarningBox("请添加收货地址!")}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")}),a.showPayLater=!1,c.get(d.bizApi+"/custs/"+s+"/biz").then(function(b){b.success?b.success&&1==b.result.supportPayLater&&(a.showPayLater=!0,$("#paylater").attr("checked","checked"),document.getElementById("paylater-div").click()):WarningBox(b.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})):3==a.step&&(c.setCookie(c.NOW_ORDER_ID,y),c.setCookie(c.NOW_ORDER_PRICE,a.total),paymentType=$('input[name="pay"]:checked').val(),1==paymentType?(b.clearCart(),window.location.href="indexApp.html#/alipay?orderId="+y):l(paymentType)),h()},a.changeNum=function(a){},a.inputBlur=function(a){a.num=a.num?a.num:1,a.num>200&&(a.num=200,WarningBox("购买的最大数量为200")),q(a.id,a.num),r(),b.updateProductNum(a.id,a.num),b.refreshCarts()},a.showAddress,a.addAddress=function(){a.showAddress=!a.showAddress},a.closeAddress=function(){a.showAddress=!a.showAddress},$.getJSON("../service/address.json",function(b){a.provinceArr=b,a.cityArr=b[0].city,a.areaArr=b[0].city[0].area,o()}),$("#province").change(function(b){var c=$(this).children("option:selected").val();a.cityArr=a.provinceArr[c].city,a.areaArr=a.cityArr[0].area,a.$apply("cityArr"),a.$apply("areaArr")}),a.changeProvince=function(b){for(var c=0;c<a.provinceArr.length;c++)if(a.provinceArr[c].name==b){a.nowCityArr=a.provinceArr[c].city;break}},a.saveAddressClick=function(){if(!n(a.newPhone))return void WarningBox("请输入有效的手机号码！");var b=$("#province").children("option:selected").val(),e=$("#city").children("option:selected").val(),f={addresses:[{address:a.newAddress,city:a.cityArr[e].name,phone:a.newPhone,name:a.newName,state:a.provinceArr[b].name,zipcode:""}]};c.post(d.orderApi+"/users/"+s+"/addresses",f).then(function(b){b.success&&(a.showAddress=!a.showAddress,o())}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},a.deleteAddressClick=function(a){var b={addresses:[{addressId:a}]};c.delete(d.orderApi+"/users/"+s+"/addresses",{data:b}).then(function(a){a.success&&(InfoBox("删除地址成功!"),o())}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},a.editAddressClick=function(b){for(var c=0;c<a.addressArr.length;c++)if(1==a.addressArr[c].edit)return void WarningBox("请先保存修改地址！");for(var c=0;c<a.provinceArr.length;c++)if(a.provinceArr[c].name==b.state){a.nowCityArr=a.provinceArr[c].city;break}b.edit=!b.edit},a.closeClick=function(a){o(),a.edit=!a.edit},a.useAddressClick=function(a){c.post(d.orderApi+"/users/"+s+"/addresses/"+a+"/primary",{}).then(function(a){a.success&&(InfoBox("使用成功!"),o())}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},a.saveUpdateClick=function(a){if("undefined"==a.name||null==a.name||0==a.name.length)return void WarningBox("请输入收件人姓名");if("undefined"==a.address||null==a.address||0==a.address.length)return void WarningBox("请输入详细地址");if(!n(a.phone))return void WarningBox("请输入有效的手机号码！");var b={addresses:[{addressId:a.addressId,address:a.address,city:a.city,state:a.state,zipcode:"",phone:a.phone,name:a.name}]};c.put(d.orderApi+"/users/"+s+"/addresses",b).then(function(a){a.success&&(InfoBox("修改地址成功!"),o())}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},a.haveAddress=!1,a.increaseClick=function(a){a.num>1&&(a.num--,b.updateProductNum(a.id,a.num),q(a.id,a.num),r(),b.refreshCarts())},a.plusClick=function(a){a.num++,b.updateProductNum(a.id,a.num),q(a.id,a.num),r(),b.refreshCarts()},a.deleteItem=function(c){b.prodRemove(c.id),p(c),r(),0==a.carts.length&&(a.haveProduct=0)},r(),a.goShopping=function(){b.toHome()},baiduLinkSubmit(),$(function(){setPageTitle("购物车","","")})}]),app.controller("orderAddressController",function(a,b){baiduLinkSubmit()}),app.controller("orderPayController",function(a,b){baiduLinkSubmit()}),app.controller("alipayController",["$scope","$rootScope","$httpService","$location","$hostService",function(a,b,c,d,e){a.paymentInfo="正在跳转到支付宝";var f=d.search().orderId;d.search().paymentType;initHeaer();c.get("/api/order/"+f+"/alipay").then(function(a){a.success?document.write(a.html):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}]),app.controller("myOrdersController",["$rootScope","$scope","$location","$httpService","$hostService","$filter",function(a,b,c,d,e,f){function g(){var a=$("#myTabs li");for(i=0;i<a.length;i++)a[i].onclick=function(){for(j=0;j<a.length;j++)a[j].className="";this.className="active"}}function h(){var a=e.orderApi+"/users/"+o+"/orders?start="+s+"&size="+(t+1);null!=q&&q.length>0&&(a+="&status="+q),d.get(a).then(function(a){if(a){s>=t?$("#preBtn").attr("disabled",!1):$("#preBtn").attr("disabled",!0),a.result.length<t+1?($("#nextBtn").attr("disabled",!0),u=!1):($("#nextBtn").attr("disabled",!1),u=!0),r.splice(0,r.length),r=a.result.slice(0,t);for(var c=0;c<r.length;c++)0==c&&m(r[0].orderId),r[c].createdOn=new Date(r[c].createdOn).toLocaleString(),b.orders=r}else WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function k(a,c){var f=e.orderApi+"/users/"+o+"/orderitems/"+a+"/status",g={status:"received"};d.post(f,g).then(function(a){a.success?b.orderItems[c].status="received":WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function l(a,b){d.post(e.orderApi+"/users/"+o+"/orders/"+b+"/status",a).then(function(a){a.success?(h(),InfoBox("您已确认收货,订单已完成!")):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function m(a){d.get(e.orderApi+"/users/"+o+"/orderitems?orderId="+a).then(function(a){if(a.success){b.orderItems=[];for(var c=0;c<a.result.length;c++)0!=a.result[c].productId&&b.orderItems.push(a.result[c]);for(var c=0;c<b.orderItems.length;c++)n(b.orderItems[c])}else WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function n(b){d.get(e.productApi+"/biz/0/prods/"+b.productId).then(function(c){if(c){var d=a.staticContentURL+"/"+a.tenant+"/assets/images/prodDefault240.jpg";null!=c.result.imgUrl&&(d=e.imageApi+"/sizes/s/imageSets/"+c.result.imgUrl),b.imgUrl=d}}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}initHeaer();var o=d.getCookie(d.USER_ID);if(null==o||0==o.length){if(configLogin(f,"my_orders"))return}b.statusArr=[];var p=[];d.get(e.orderApi+"/orderstatus").then(function(a){
if(a.success){b.statusArr.push("全部");for(var c=0;c<a.result.length;c++){var d=a.result[c];"pending"==d?(b.statusArr.push("未付款"),p.push(d)):"payed"==d?(b.statusArr.push("已付款"),p.push(d)):"completed"==d?(b.statusArr.push("已完成"),p.push(d)):"canceled"==d&&(b.statusArr.push("取消"),p.push(d))}p=p,window.setTimeout(function(){g()},100)}else WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")});var q="";b.statusClick=function(a){q=a>0?p[a-1]:"",h()};var o=d.getCookie(d.USER_ID),r=[],s=0,t=10,u=!1;$("#preBtn").attr("disabled",!0),h(),b.cancleOrderClick=function(a){},b.confirmReceiptClick=function(a){l({orderStatus:"completed",statusMsg:""},a);for(var c=0;c<b.orderItems.length;c++){k(b.orderItems[c].itemId,c)}},b.orderDetailClick=function(a){m(a)},b.cancleClick=function(a){var b={orderStatus:"canceled",statusMsg:""};d.post(e.orderApi+"/users/"+o+"/orders/"+a+"/status",b).then(function(a){a.success?InfoBox("取消订单成功!"):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},b.payClick=function(a){window.location.href="indexApp.html#/alipay?orderId="+a},b.reOrderClick=function(a){window.location.href="indexApp.html#/orderInfo?reOrderItems="+JSON.stringify(a)},b.previousPageClick=function(){s>=t&&(s-=t,h())},b.nextPageClick=function(){u&&(s+=t,h())},b.commentClick=function(a){window.location.href="indexApp.html#/comment?orderId="+a},b.goto=function(a){c.hash(a),$anchorScroll()},$(function(){setPageTitle("订单详情","","")})}]),app.controller("commentController",["$scope","$rootScope","$location","$anchorScroll","$httpService","$hostService",function(a,b,c,d,e,f){function g(a){e.get(f.productApi+"/biz/0/prods/"+a.productId).then(function(c){if(c.result){var d=b.staticContentURL+"/"+b.tenant+"/assets/images/prodDefault240.jpg";null!=c.result.imgUrl&&(d=f.imageApi+"/sizes/s/imageSets/"+c.result.imgUrl),a.imgUrl=d}}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}var h=c.search().orderId,i=e.getCookie(e.USER_ID);initHeaer(),e.get(f.orderApi+"/users/"+i+"/orderitems?orderId="+h).then(function(b){if(b.success){a.orderItems=[];for(var c=0;c<b.result.length;c++)0!=b.result[c].productId&&a.orderItems.push(b.result[c]);for(var c=0;c<a.orderItems.length;c++)g(a.orderItems[c])}else WarningBox(b.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")}),a.max=5,a.readonly=!1,a.submitCommentClick=function(){for(var b=[],c=e.getCookie(e.USER_NAME),d=e.getCookie(e.CITY),g=0;g<a.orderItems.length;g++){var h="star"+g,i="textarea"+g,j=parseInt($("#"+h).html()),k=$("#"+i).val(),l=a.orderItems[g].productId,d=e.getCookie(e.CITY);null==d&&(d="");var m={prodId:l,comment:k,rating:j,userName:c,active:1,city:d};b.push(m)}e.post(f.productApi+"/biz/0/prodComments",{prodComments:b}).then(function(a){a.success?(InfoBox("感谢您的评论"),window.history.go(-1)):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},baiduLinkSubmit()}]),app.controller("logisticTrackingController",["$rootScope","$scope","$location","$httpService","$hostService",function(a,b,c,d,e){c.search().orderId;initHeaer(),b.arr=[{time:"2016-03-10 18:07:15",info:"感谢您在京东购物，欢迎您再次光临！"},{time:"2016-03-10 18:07:15",info:"【京东到家】京东配送员【申国龙】已出发，联系电话【18410106883，感谢您的耐心等待，参加评价还能赢取京豆呦】"},{time:"2016-03-10 18:07:15",info:"感谢您在京东购物，欢迎您再次光临！"},{time:"2016-03-10 18:07:15",info:"感谢您在京东购物，欢迎您再次光临！"},{time:"2016-03-10 18:07:15",info:"感谢您在京东购物，欢迎您再次光临！"},{time:"2016-03-10 18:07:15",info:"感谢您在京东购物，欢迎您再次光临！"}],baiduLinkSubmit()}]),app.controller("aboutUsController",["$scope","$rootScope","$httpService","$location","$hostService","$filter",function(a,b,c,d,e,f){baiduLinkSubmit(),$(function(){setPageTitle("公司介绍","","")})}]),app.controller("serviceRegulationController",["$scope","$rootScope","$httpService","$location","$hostService","$filter",function(a,b,c,d,e,f){baiduLinkSubmit(),$(function(){var a="",b=d.url();"/user_register_guide"==b?a="用户注册_":"/purchase_guide"==b?a="购买流程_":"/serviceRegulation"==b?a="使用规则_":"/online_payment_guide"==b?a="在线支付_":"/cod_guide"==b?a="货到付款_":"/distribution_notice_guide"==b?a="配送须知_":"/distribution_range_guide"==b?a="配送范围_":"/server_info_guide"==b?a="服务说明_":"/server_detail_guide"==b?a="服务细则_":"/biz_settled_guide"==b?a="商家入驻_":"/contact_us_guide"==b?a="联系我们_":"/cityPartner"==b?a="城市合伙人_":"/supplierRecruitment"==b&&(a="供应商入驻_"),setPageTitle(a,"","")})}]),app.controller("paySuccessController",["$rootScope","$scope","$location","$httpService","$hostService",function(a,b,c,d,e){initHeaer(),b.continueClick=function(){window.location.href="/"},b.orderClick=function(){window.location.href="indexApp.html#/my_orders"},b.orderPrice=d.getCookie(d.NOW_ORDER_PRICE),b.orderId=d.getCookie(d.NOW_ORDER_ID)}]),app.controller("myCollectionController",["$rootScope","$scope","$location","$httpService","$hostService","$filter",function(a,b,c,d,e,f){function g(){d.get(e.productApi+"/favoriteProds").then(function(a){a.success?b.products=a.result:WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}initHeaer(),b.imageService=e.imageApi+"/sizes/m/imageSets/",g(),b.deleteClick=function(a){var b={prods:[a]};d.delete(e.productApi+"/favoriteProds",{data:b}).then(function(a){a.success?g():WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},b.gotoDetail=function(a,b){window.location.href="indexApp.html#/product/"+a+"/bizId/"+b},b.addShoppingCartClick=function(c,d,e,f){a.prodPush(c,d);var g="#add-cart-btn"+e,h=$(g).offset(),i=a.staticContentURL+"/"+a.tenant+"/assets/images/prodDefault240.jpg";null!=c.imgUrl&&c.imgUrl.length>0&&(i=b.imageService+c.imgUrl);var j=0,k=0;"栅格"==f?(j=h.left+30,k=h.top-5-scrollY):(j=h.left+20,k=h.top-scrollY);var l=$('<img class="u-flyer" src="'+i+'">');l.css({width:"50px",height:"50px"}),l.fly({start:{left:j,top:k},end:{left:a.cartOffset.left+10,top:a.cartOffset.top+10,width:0,height:0},onEnd:function(){this.destory()}})},$(function(){setPageTitle("我的收藏","","")})}]),app.controller("myProdListController",["$scope","$rootScope","$httpService","$location","$hostService","$filter",function(a,b,c,d,e,f){function g(){c.get(e.bizApi+"/custs/"+i+"/customerprices").then(function(b){if(b.success){for(var c=0;c<b.result.length;c++)b.result[c].num=0,b.result[c].productName=b.result[c].prodName;a.products=b.result;for(var c=0;c<a.products.length;c++)h(a.products[c])}else WarningBox(b.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function h(a){c.get(e.productApi+"/biz/0/prods/"+a.prodId).then(function(c){if(c){var d=b.staticContentURL+"/"+b.tenant+"/assets/images/prodDefault240.jpg";null!=c.result.imgUrl&&(d=c.result.imgUrl),a.imgUrl=d}}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}var i=c.getCookie(c.USER_ID);initHeaer(),g(),a.imageService=e.imageApi+"/sizes/m/imageSets/",a.increaseClick=function(a){0!=a.num&&a.num--},a.nextClick=function(){$("input[name='checkbox']").each(function(a){if($(this).attr("checked")){var c=$(this).val(),d=JSON.parse(c);parseInt(d.num)>0&&b.prodPush(d,parseInt(d.num))}}),window.location.href="indexApp.html#/orderInfo"},a.plusClick=function(a){a.num++},$(".allSelect").change(function(){$(".allSelect").is(":checked")?$("input[name='checkbox']").attr("checked","true"):$("input[name='checkbox']").removeAttr("checked")}),a.gotoDetail=function(a,b){window.location.href="indexApp.html#/product/"+a+"/bizId/0"},$(function(){setPageTitle("订单列表","","")})}]),app.controller("personalCenterController",["$rootScope","$scope","$location","$httpService","$hostService","$filter",function(a,b,c,d,e,f){b.loginUserName=d.getCookie(d.USER_NAME),$(function(){setPageTitle("个人中心","","")})}]),app.controller("tvController",["$rootScope","$scope","$location","$httpService","$hostService","$filter",function(a,b,c,d,e,f){b.products=[],b.product="",b.imageDes=e.imageApi+"/images/",b.productRequest=function(){var a=e.productApi+"/prods";d.get(a).then(function(a){a.success?(b.products=a.result,window.setTimeout(function(){$("#productSelect").val(b.products[0].prodId),b.getProductDetail()},200)):b.products=[]}).catch(function(a){ErrorBox("服务器内部错误")})},b.getProductDetail=function(){b.imgData=[];var a=$("#productSelect").val(),c=e.productApi+"/biz/0/prods/"+a;""!=a&&d.get(c).then(function(a){if(a.success)for(var c in a.result.images){var d=a.result.images[c];"description"==d.img_type&&b.imgData.push(a.result.images[c])}else WarningBox(a.msg)}).catch(function(a){ErrorBox("服务器内部错误")})},b.productRequest(),$(function(){setPageTitle("","","")})}]),app.controller("headerController",["$scope","$element","$httpService","$rootScope","$hostService","$filter","sharedData","$location",function(a,b,c,d,e,f,g,h){function i(){var b=e.productApi+"/biz/0/prodTypes";c.get(b).then(function(b){b&&(a.categories=sortCategory(b.result))}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}var j=getTenant();c.setCookie(c.TENANT,j),d.isMobile=checkPlatform(),d.setCookieStatus="",a.enterEvent=function(b){13==(window.event?b.keyCode:b.which)&&a.search()},window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),document.documentElement&&document.documentElement.clientWidth&&(winWidth=document.documentElement.clientWidth),winWidth>991?window.setTimeout(function(){var a=$("#cart").offset();d.cartOffset=a},500):window.setTimeout(function(){var a=$("#cart-iphone").offset();d.cartOffset=a},500),a.keyword="",a.mobileKeyword="",a.items=[],d.userName=c.getCookie("username")?c.getCookie("username"):null,a.imageService=e.imageApi+"/sizes/m/imageSets/",a.categories=[],d.nowPath="",d.logOut=function(){c.removeCookie(c.COMMON_AUTH_NAME),c.removeCookie(c.USER_ID),c.removeCookie(c.USER_NAME),d.userId=null,c.setCookie("username",null),c.setCookie("isLogin",null),d.userName=c.getCookie("username"),d.isLogin=!1,window.location.href="indexApp.html#/login"},a.search=function(){var a=$("#webProdcutSearch").val();a.length>0&&(window.location.href="indexApp.html#/product_filter/"+a+"/type/2")};var k=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("category"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"./assets/search.json",remote:{url:e.productApi+"/prodSearch/%QUERY?start=0&size=10",wildcard:"%QUERY"}});$("#searchInput").typeahead(null,{name:"search",display:"category",source:k}),a.gotoSecondCategory=function(a){window.location.href="indexApp.html#/product_filter/"+a+"/type/1"},i(),product={id:0,name:"",num:0,price:0,productCode:"",supplierId:"",supplierName:""},d.orderdetail={username:"",phone:"",address:"",zipcode:"",totalNumber:0,totalAmount:0},d.allProduct=function(){var b=localStorage.getItem("ShoppingCart"),c=null;if(b){var e=JSON.parse(b.substr(1,b.length));c=e.productlist,d.orderdetail.totalNumber=e.totalNumber,d.orderdetail.totalAmount=e.totalAmount?parseFloat(e.totalAmount).toFixed(2):0}var f=0;if(c instanceof Array)for(var g=0;g<c.length;g++)f+=c[g].num;return a.allNum=f,c},d.carts=null!=d.allProduct()?d.allProduct():[],d.prodRemove=function(a){var b=localStorage.getItem("ShoppingCart"),c=JSON.parse(b.substr(1,b.length)),e=c.productlist,f=[];for(var h in e)e[h].id==a?(c.totalNumber=parseInt(c.totalNumber)-parseInt(e[h].num),c.totalAmount=parseFloat(c.totalAmount)-parseInt(e[h].num)*parseFloat(e[h].price)):f.push(e[h]);c.productlist=f,d.orderdetail.totalNumber=c.totalNumber,d.orderdetail.totalAmount=c.totalAmount,localStorage.setItem("ShoppingCart","'"+JSON.stringify(c)),d.carts=null!=d.allProduct()?d.allProduct():[],g.saveCarts(d.carts)},d.clearCart=function(){localStorage.removeItem("ShoppingCart"),d.carts=null!=d.allProduct()?d.allProduct():[],g.saveCarts(d.carts)},d.prodPush=function(a,b){null==a.special_price&&(a.special_price=-1);var c=localStorage.getItem("ShoppingCart");if(null==c||""==c){var e={productlist:[{id:a.prodId,name:a.productName,num:b,price:a.price,image:a.imgUrl,specialPrice:a.special_price,productCode:a.prodCode,supplierId:a.bizId,supplierName:a.bizName,unitOfMeasure:a.unitOfMeasure}],totalNumber:b,totalAmount:a.price*b};localStorage.setItem("ShoppingCart","'"+JSON.stringify(e)),Toast("已添加到购物车!")}else{var e=JSON.parse(c.substr(1,c.length)),f=e.productlist,h=!1;for(var i in f)f[i].id==a.prodId&&(f[i].num=parseInt(f[i].num)+parseInt(b),h=!0);h||(f.push({id:a.prodId,name:a.productName,num:b,price:a.price,image:a.imgUrl,specialPrice:a.special_price,productCode:a.prodCode,supplierId:a.bizId,supplierName:a.bizName,unitOfMeasure:a.unitOfMeasure}),Toast("已添加到购物车!")),e.totalNumber=parseInt(e.totalNumber)+parseInt(b),e.totalAmount=parseFloat(e.totalAmount)+parseInt(b)*parseFloat(a.price),d.orderdetail.totalNumber=e.totalNumber,d.orderdetail.totalAmount=e.totalAmount,localStorage.setItem("ShoppingCart","'"+JSON.stringify(e))}d.carts=null!=d.allProduct()?d.allProduct():[],g.saveCarts(d.carts)},d.updateProductNum=function(a,b){var c=localStorage.getItem("ShoppingCart"),e=JSON.parse(c.substr(1,c.length)),f=e.productlist;for(var g in f)if(f[g].id==a){e.totalNumber=parseInt(e.totalNumber)+(parseInt(b)-parseInt(f[g].num)),e.totalAmount=(parseFloat(e.totalAmount)+(parseInt(b)*parseFloat(f[g].price)-parseInt(f[g].num)*parseFloat(f[g].price))).toFixed(2),f[g].num=parseInt(b),d.orderdetail.totalNumber=e.totalNumber,d.orderdetail.totalAmount=e.totalAmount,localStorage.setItem("ShoppingCart","'"+JSON.stringify(e));break}},d.refreshCarts=function(){d.carts=null!=d.allProduct()?d.allProduct():[],g.saveCarts(d.carts)},d.updateSpecialPrice=function(a,b){var c=localStorage.getItem("ShoppingCart"),e=JSON.parse(c.substr(1,c.length)),f=e.productlist;for(var h in f)if(f[h].id==a)return f[h].specialPrice=b,localStorage.setItem("ShoppingCart","'"+JSON.stringify(e)),d.carts=null!=d.allProduct()?d.allProduct():[],void g.saveCarts(d.carts)},d.ifProductExist=function(a){var b=localStorage.getItem("ShoppingCart"),c=JSON.parse(b.substr(1,b.length)),d=c.productlist,e=!1;for(var f in d)d[f].id==a&&(e=!0);return e},d.$on("$routeChangeSuccess",function(){$(".product-label").hide(),d.nowPath=h.path()}),d.toHome=function(){window.location="/"},d.toOrderInfo=function(){window.location="indexApp.html#/orderInfo"},"1"==c.getCookie("isLogin")?d.isLogin=!0:d.isLogin=!1,a.showLabel=function(){$(".product-label").toggle()},$(document).ready(function(){$("#scrollDiv").length>0&&$("#scrollDiv").Scroll({line:1,speed:500,timer:3e3,up:"but_up",down:"but_down"})})}]),app.controller("home2Controller",["$rootScope","$scope","$httpService","$hostService","$filter","sharedData","$location",function(a,b,c,d,e,f,g){function h(){c.get(d.productApi+"/favoriteProds").then(function(a){a.success?b.collections=a.result:WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function i(){c.get(d.productApi+"/biz/0/tags/2/prods").then(function(a){a.success?(b.bannerList=a.result,j(a.result)):WarningBox(a.msg)}).catch(function(a){ErrorBox("获取banner列表服务器内部错误")})}function j(a){for(var e=0;e<a.length;e++){var f=a[e];c.get(d.productApi+"/biz/"+f.bizId+"/prods/"+f.prodId).then(function(a){if(a.success){if(null!=a.result.images&&a.result.images.length>0)for(var c=0;c<a.result.images.length;c++){var d=a.result.images[c];"banner"==d.img_type&&(b.bannerImgUrl.push(a.result.images[c].img_url),console.log(b.bannerImageService+a.result.images[c].img_url))}}else WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}}function k(b){var c="";c=o?$("#selectMbProduct"):$("#selectPcProduct"),c.select2({language:"zh-CN",placeholder:"请输入商品名称",width:"100%",multiple:!0,maximumSelectionLength:1,minimumInputLength:1,tags:!1,allowClear:!1,data:b,ajax:{url:d.productApi+"/biz/0/prodsList?active=1",dataType:"json",delay:250,allowClear:!1,data:function(b){return{name:b.term,tenant:a.tenant}},processResults:function(a,b){for(var c=[],d={id:"T01",text:"标签",element:"HTMLOptGroupElement",children:[]},e={id:"T02",text:"产品",element:"HTMLOptGroupElement",children:[]},f=0;f<a.label.length;f++){var g={id:a.label[f].id,text:a.label[f].label_name};d.children.push(g)}for(var f=0;f<a.prod.length;f++){var g={id:a.prod[f].prod_id,text:a.prod[f].name};e.children.push(g)}return e.children.length>0&&c.push(e),d.children.length>0&&c.push(d),{results:c}},cache:!0},escapeMarkup:function(a){return a},templateSelection:function(a){return window.setTimeout(function(){$(".select2-search__field").val("")},100),a.text}})}a.headerSearch=0,a.headerNav=0,b.category=[],b.recommeds=[],b.bannerList=[],b.bannerImgUrl=[],b.imageService=d.imageApi+"/sizes/m/imageSets/",b.bannerImageService=d.imageApi+"/images/";var l=c.getCookie(c.USER_ID),m=c.getCookie(c.BIZ_ID),n=g.search().zyUser?g.search().zyUser:null;null!=n&&f.saveZyUser(n),initHeaer();var o=checkPlatform();window.setTimeout(function(){OwlCarousel.initOwlCarousel()},1e3),b.categoryClick=function(a){console.log("商品分类Id="+a),window.location.href="indexApp.html#/product_filter/"+a+"/type/1"},c.get(d.productApi+"/tags/1/prodTypes").then(function(a){if(b.category=[],a.result.length>9)for(var c=0;c<9;c++)b.category.push(a.result[c]);else b.category=a.result}).catch(function(a){"NotAuthorized"!=error.code&&ErrorBox("服务器内部错误")}),c.get(d.productApi+"/biz/0/tags/1/prods").then(function(a){a.success?b.recommeds=a.result.slice(0,20):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=error.code&&ErrorBox("服务器内部错误")}),a.imageSize=function(a){return d.imageApi+"/sizes/"+a+"/imageSets/"};var p=0,q=0;window.onscroll=function(){p=window.scrollY,q=window.scrollX},b.addCollectionClick=function(a){var e={prods:[a.prodId]};c.post(d.productApi+"/favoriteProds",e).then(function(c){c.success?c.result.length>0?c.result[0].success?(b.collections.push(a),Toast("已添加到收藏!")):WarningBox("当前商品已经收藏,请到我的收藏里查看!"):WarningBox("添加收藏失败!"):WarningBox(c.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},b.deleteCollectionClick=function(a){var b={prods:[a.prodId]};c.delete(d.productApi+"/favoriteProds",{data:b}).then(function(a){a.success?h():WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},b.ifHasInFavorite=function(a){var c=!1;for(var d in b.collections){b.collections[d].prodId==a&&(c=!0)}return c},b.addShoppingCartClick=function(c,d,e,f){a.prodPush(c,d);var g="#add-cart-btn"+e,h=$(g).offset(),i=a.staticContentURL+"/"+a.tenant+"/assets/images/prodDefault240.jpg";null!=c.imgUrl&&c.imgUrl.length>0&&(i=b.imageService+c.imgUrl);var j=$('<img class="u-flyer" src="'+i+'">');j.css({width:"50px",height:"50px"}),j.fly({start:{left:h.left-q+30,top:h.top-p},end:{left:a.cartOffset.left+10,top:a.cartOffset.top+10,width:0,height:0},onEnd:function(){this.destory()}})},b.bannerLinkToProduct=function(a){var c=b.bannerList[a];c&&(window.location.href="indexApp.html#/product/"+c.prodId+"/bizId/0")},b.home2Search=function(){var a="",b=[];a=$(".select2-search__field").val(),b=o?$("#selectMbProduct").select2("data"):$("#selectPcProduct").select2("data"),a.length>0&&(window.location.href="indexApp.html#/product_filter/"+a+"/type/3"),b.length>0&&(window.location.href="indexApp.html#/product_filter/"+b[0].text+"/type/3")},b.toHome=function(){window.location.href="/"};var r=function(){if(-1!=g.$$url.indexOf("json")){var c=g.$$url.split("=")[1],d=JSON.parse(decodeURIComponent(c)),e=f.getOrderInfo(),h=[];for(var i in d.roomsInfo)""!==d.roomsInfo[i].id&&h.push(d.roomsInfo[i]);d.roomsInfo=h,f.saveOrderInfo(d),void 0==d.orderId?InfoBox("订单号不存在!"):null!==e&&e.orderId!==d.orderId&&(window.setTimeout(function(){a.allNum=0,a.clearCart(),b.$apply()},1e3),window.setTimeout(function(){b.$apply()},2e3)),0==d.roomsInfo.length?InfoBox("空间信息不存在!"):void 0==d.authorization&&InfoBox("Token不存在!")}},s=function(){if(null==l||0==l.length||null==m||0==m.length){if(configLogin(e,"home2"))return}};checkPlatform(),i(),r(),b.$watch("setCookieStatus",function(d,e){!0===a.setCookieStatus?(a.isLogin=!0,a.userName=c.getCookie("username")):-1===g.$$url.indexOf("json")&&s(),console.log("getCookie-isLogin :"+c.getCookie("isLogin")),console.log("time :"+new Date),window.setTimeout(function(){"1"==c.getCookie("isLogin")&&(a.isLogin=!0,a.userName=c.getCookie("username")?c.getCookie("username"):null,b.$apply("isLogin"),b.$apply("userName"))},5e3)}),$(function(){window.setTimeout(function(){k()},100),baiduLinkSubmit(),setPageTitle("","","")})}]),app.controller("orderInfo2Controller",["$scope","$rootScope","$httpService","$hostService","$interval","$location","$filter","sharedData",function(a,b,c,d,e,f,g,h){function j(){var b=[];$("input:checkbox[name=checkboxId]:checked").each(function(a){var c=JSON.parse($(this).val());b.push(c)}),a.selectItems=b}function k(b){var c=null;for(i in a.selectItems){var d=a.selectItems[i];b.id==d.id&&(c=i)}c&&a.selectItems.splice(parseInt(c),1)}function l(b,c){for(index in a.selectItems){var d=a.selectItems[index];d.id==b&&(d.num=c)}}function m(){if(a.selectItems){var b=0;a.freight=0;for(var c=0;c<a.selectItems.length;c++)-1!=a.selectItems[c].specialPrice&&null!=a.selectItems[c].specialPrice?b+=a.selectItems[c].specialPrice*a.selectItems[c].num:b+=a.selectItems[c].price*a.selectItems[c].num;a.subtotal=b.toFixed(2),a.total=(b+a.freight).toFixed(2)}}var n=c.getCookie(c.USER_ID),o=c.getCookie(c.BIZ_ID),p=f.search().reOrderItems,q=p?JSON.parse(p):null;g("translate")("isLogin");if(a.selectItems=[],a.roomsInfo=[],a.ncaOrderInfo=h.getOrderInfo(),a.chartsArr=[],null==n||0==n.length||null==o||0==o.length)return void(window.location.href="indexApp.html#/login?whereCome=orderInfo2");var r=function(){var a=localStorage.getItem("ShoppingCart"),b=null;if(a){b=JSON.parse(a.substr(1,a.length)).productlist}return b};if(a.chartsArr=null!=r()?r():[],a.ncaOrderInfo&&(a.roomsInfo=a.ncaOrderInfo.roomsInfo),initHeaer(),q)for(index in q){var s=q[index],t={};t.prodId=s.productId,t.id=s.productId,t.productName=s.productName,t.name=s.productName,t.price=s.unitPrice,t.imgUrl=s.imgUrl?s.imgUrl.split("/").slice(-1)[0]:null,t.special_price=s.unitPrice,t.specialPrice=s.unitPrice,t.productCode=s.productCode,t.supplierId=s.bizId,t.supplierName=s.supplierName,t.unitOfMeasure=s.unitOfMeasure,t.num=s.quantity,b.prodPush(t,s.quantity),a.selectItems.push(t)}else a.selectItems=a.chartsArr;a.imageService=d.imageApi+"/sizes/m/imageSets/",null!=a.chartsArr&&a.chartsArr.length>0?a.haveProduct=1:a.haveProduct=0,a.stepDescription="检验 & 编辑你的产品",a.validateCheck=function(b){var c=!1;for(index in a.selectItems){var d=a.selectItems[index];if(b.id==d.id){c=!0;break}}return c},a.selectClick=function(){j(),m()},a.changeNum=function(a){},a.inputBlur=function(a){a.num=a.num?a.num:1,l(a.id,a.num),m(),b.updateProductNum(a.id,a.num),b.refreshCarts()};var u={};a.createOrder=function(){if(a.ncaOrderInfo){if(0==a.ncaOrderInfo.roomsInfo.length)return void InfoBox("空间信息不存在!");if(void 0==a.ncaOrderInfo.orderId)return void InfoBox("订单号不存在!");if(void 0==a.ncaOrderInfo.authorization)return void InfoBox("Token不存在!");for(var b=[],c=0;c<a.selectItems.length;c++){a.selectItems[c].price;var d=$("#shopList"+a.selectItems[c].productCode+" .romeSelect").val();if(""===d)return void InfoBox("空间不能为空!");var e={materiel_amount:a.selectItems[c].num,materiel_code:a.selectItems[c].productCode,room_id:d};b.push(e)}var f={order_id:a.ncaOrderInfo.orderId,authorization:a.ncaOrderInfo.authorization,materiels:b};u=f,console.log("requestParams"),console.log(u),$("#sure-dialog").modal("show")}else InfoBox("订单信息不存在!")},a.increaseClick=function(a){if(a.num>1){var c=v();a.num--,b.updateProductNum(a.id,a.num),l(a.id,a.num),m(),b.refreshCarts(),window.setTimeout(function(){w(c)},200)}},a.plusClick=function(a){var c=v();a.num++,b.updateProductNum(a.id,a.num),l(a.id,a.num),m(),b.refreshCarts(),window.setTimeout(function(){w(c)},200)};var v=function(){for(var a=[],c=0;c<b.carts.length;c++){var d=$("#shopList"+b.carts[c].productCode+" .romeSelect").val();if(""!==d){var e={productCode:b.carts[c].productCode,roomId:d};a.push(e)}}return a},w=function(a){for(var b in a)$("#shopList"+a[b].productCode+" .romeSelect").val(a[b].roomId)};a.deleteItem=function(c){b.prodRemove(c.id),k(c),m(),0==a.chartsArr.length&&(a.haveProduct=0)},a.stepForward=function(){$("#sure-dialog").modal("show")},a.onSure=function(){var a=u;c.post("/api/sendNca",a).then(function(a){0===a.errno?($("#sure-dialog").modal("hide"),InfoBox("选择成功，3秒后此页面将关闭。"),b.clearCart(),c.removeCookie(c.COMMON_AUTH_NAME),c.removeCookie(c.USER_ID),c.removeCookie(c.USER_NAME),c.removeCookie(c.CITY),c.removeCookie(c.BIZ_ID),c.removeCookie(c.BIZ_NAME),c.removeCookie(c.CITY),c.setCookie("isLogin","0"),c.removeCookie("username"),localStorage.removeItem("orderInfo"),window.setTimeout(function(){CloseWebPage()},3e3)):(console.log(a),WarningBox(a.msg))}).catch(function(a){"NotAuthorized"!==a.code?ErrorBox("服务器内部错误"):window.location.href="indexApp.html#/login?whereCome=orderInfo"})},m(),a.goShopping=function(){b.toHome()},baiduLinkSubmit(),$(function(){setPageTitle("购物车","","")})}]),app.controller("setCookieController",["$scope","$rootScope","$httpService","$location","$hostService",function(a,b,c,d,e){if(-1!==d.$$url.indexOf("setCookie")){var f=d.$$url.split("=")[1],g=JSON.parse(decodeURIComponent(f));c.setCookie(c.COMMON_AUTH_NAME,g.accessToken),c.setCookie(c.USER_ID,g.userId),c.setCookie(c.USER_NAME,g.name),c.setCookie(c.CITY,g.city),c.setCookie(c.REMEBER_PWD,!1),null==g.bizId?c.setCookie(c.BIZ_ID,0):(c.setCookie(c.BIZ_ID,g.bizId),c.setCookie(c.BIZ_NAME,g.bizName)),c.setCookie("isLogin","1"),c.setCookie("username",g.name),$.cookie("username2",g.name),b.userName=c.getCookie("username"),b.isLogin=!0,b.setCookieStatus=!0,console.log("start $.cookie : "+b.setCookieStatus)}else b.setCookieStatus=!1}]);