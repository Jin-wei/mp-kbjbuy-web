app.controller("headerController",["$scope","$element","$httpService","$rootScope","$hostService","$filter","sharedData","$location",function(a,b,c,d,e,f,g,h){function i(){var b=e.productApi+"/biz/0/prodTypes";c.get(b).then(function(b){b&&(a.categories=sortCategory(b.result))}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}var j=getTenant();c.setCookie(c.TENANT,j),d.isMobile=checkPlatform(),d.setCookieStatus="",a.enterEvent=function(b){13==(window.event?b.keyCode:b.which)&&a.search()},window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),document.documentElement&&document.documentElement.clientWidth&&(winWidth=document.documentElement.clientWidth),winWidth>991?window.setTimeout(function(){var a=$("#cart").offset();d.cartOffset=a},500):window.setTimeout(function(){var a=$("#cart-iphone").offset();d.cartOffset=a},500),a.keyword="",a.mobileKeyword="",a.items=[],d.userName=c.getCookie("username")?c.getCookie("username"):null,a.imageService=e.imageApi+"/sizes/m/imageSets/",a.categories=[],d.nowPath="",d.logOut=function(){c.removeCookie(c.COMMON_AUTH_NAME),c.removeCookie(c.USER_ID),c.removeCookie(c.USER_NAME),d.userId=null,c.setCookie("username",null),c.setCookie("isLogin",null),d.userName=c.getCookie("username"),d.isLogin=!1,window.location.href="indexApp.html#/login"},a.search=function(){var a=$("#webProdcutSearch").val();a.length>0&&(window.location.href="indexApp.html#/product_filter/"+a+"/type/2")};var k=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("category"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"./assets/search.json",remote:{url:e.productApi+"/prodSearch/%QUERY?start=0&size=10",wildcard:"%QUERY"}});$("#searchInput").typeahead(null,{name:"search",display:"category",source:k}),a.gotoSecondCategory=function(a){window.location.href="indexApp.html#/product_filter/"+a+"/type/1"},i(),product={id:0,name:"",num:0,price:0,productCode:"",supplierId:"",supplierName:""},d.orderdetail={username:"",phone:"",address:"",zipcode:"",totalNumber:0,totalAmount:0},d.allProduct=function(){var b=localStorage.getItem("ShoppingCart"),c=null;if(b){var e=JSON.parse(b.substr(1,b.length));c=e.productlist,d.orderdetail.totalNumber=e.totalNumber,d.orderdetail.totalAmount=e.totalAmount?parseFloat(e.totalAmount).toFixed(2):0}var f=0;if(c instanceof Array)for(var g=0;g<c.length;g++)f+=c[g].num;return a.allNum=f,c},d.carts=null!=d.allProduct()?d.allProduct():[],d.prodRemove=function(a){var b=localStorage.getItem("ShoppingCart"),c=JSON.parse(b.substr(1,b.length)),e=c.productlist,f=[];for(var h in e)e[h].id==a?(c.totalNumber=parseInt(c.totalNumber)-parseInt(e[h].num),c.totalAmount=parseFloat(c.totalAmount)-parseInt(e[h].num)*parseFloat(e[h].price)):f.push(e[h]);c.productlist=f,d.orderdetail.totalNumber=c.totalNumber,d.orderdetail.totalAmount=c.totalAmount,localStorage.setItem("ShoppingCart","'"+JSON.stringify(c)),d.carts=null!=d.allProduct()?d.allProduct():[],g.saveCarts(d.carts)},d.clearCart=function(){localStorage.removeItem("ShoppingCart"),d.carts=null!=d.allProduct()?d.allProduct():[],g.saveCarts(d.carts)},d.prodPush=function(a,b){null==a.special_price&&(a.special_price=-1);var c=localStorage.getItem("ShoppingCart");if(null==c||""==c){var e={productlist:[{id:a.prodId,name:a.productName,num:b,price:a.price,image:a.imgUrl,specialPrice:a.special_price,productCode:a.prodCode,supplierId:a.bizId,supplierName:a.bizName,unitOfMeasure:a.unitOfMeasure}],totalNumber:b,totalAmount:a.price*b};localStorage.setItem("ShoppingCart","'"+JSON.stringify(e)),Toast("已添加到购物车!")}else{var e=JSON.parse(c.substr(1,c.length)),f=e.productlist,h=!1;for(var i in f)f[i].id==a.prodId&&(f[i].num=parseInt(f[i].num)+parseInt(b),h=!0);h||(f.push({id:a.prodId,name:a.productName,num:b,price:a.price,image:a.imgUrl,specialPrice:a.special_price,productCode:a.prodCode,supplierId:a.bizId,supplierName:a.bizName,unitOfMeasure:a.unitOfMeasure}),Toast("已添加到购物车!")),e.totalNumber=parseInt(e.totalNumber)+parseInt(b),e.totalAmount=parseFloat(e.totalAmount)+parseInt(b)*parseFloat(a.price),d.orderdetail.totalNumber=e.totalNumber,d.orderdetail.totalAmount=e.totalAmount,localStorage.setItem("ShoppingCart","'"+JSON.stringify(e))}d.carts=null!=d.allProduct()?d.allProduct():[],g.saveCarts(d.carts)},d.updateProductNum=function(a,b){var c=localStorage.getItem("ShoppingCart"),e=JSON.parse(c.substr(1,c.length)),f=e.productlist;for(var g in f)if(f[g].id==a){e.totalNumber=parseInt(e.totalNumber)+(parseInt(b)-parseInt(f[g].num)),e.totalAmount=(parseFloat(e.totalAmount)+(parseInt(b)*parseFloat(f[g].price)-parseInt(f[g].num)*parseFloat(f[g].price))).toFixed(2),f[g].num=parseInt(b),d.orderdetail.totalNumber=e.totalNumber,d.orderdetail.totalAmount=e.totalAmount,localStorage.setItem("ShoppingCart","'"+JSON.stringify(e));break}},d.refreshCarts=function(){d.carts=null!=d.allProduct()?d.allProduct():[],g.saveCarts(d.carts)},d.updateSpecialPrice=function(a,b){var c=localStorage.getItem("ShoppingCart"),e=JSON.parse(c.substr(1,c.length)),f=e.productlist;for(var h in f)if(f[h].id==a)return f[h].specialPrice=b,localStorage.setItem("ShoppingCart","'"+JSON.stringify(e)),d.carts=null!=d.allProduct()?d.allProduct():[],void g.saveCarts(d.carts)},d.ifProductExist=function(a){var b=localStorage.getItem("ShoppingCart"),c=JSON.parse(b.substr(1,b.length)),d=c.productlist,e=!1;for(var f in d)d[f].id==a&&(e=!0);return e},d.$on("$routeChangeSuccess",function(){$(".product-label").hide(),d.nowPath=h.path()}),d.toHome=function(){window.location="/"},d.toOrderInfo=function(){window.location="indexApp.html#/orderInfo"},"1"==c.getCookie("isLogin")?d.isLogin=!0:d.isLogin=!1,a.showLabel=function(){$(".product-label").toggle()},$(document).ready(function(){$("#scrollDiv").length>0&&$("#scrollDiv").Scroll({line:1,speed:500,timer:3e3,up:"but_up",down:"but_down"})})}]),app.controller("home2Controller",["$rootScope","$scope","$httpService","$hostService","$filter","sharedData","$location",function(a,b,c,d,e,f,g){function h(){c.get(d.productApi+"/favoriteProds").then(function(a){a.success?b.collections=a.result:WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}function i(){c.get(d.productApi+"/biz/0/tags/2/prods").then(function(a){a.success?(b.bannerList=a.result,j(a.result)):WarningBox(a.msg)}).catch(function(a){ErrorBox("获取banner列表服务器内部错误")})}function j(a){for(var e=0;e<a.length;e++){var f=a[e];c.get(d.productApi+"/biz/"+f.bizId+"/prods/"+f.prodId).then(function(a){if(a.success){if(null!=a.result.images&&a.result.images.length>0)for(var c=0;c<a.result.images.length;c++){var d=a.result.images[c];"banner"==d.img_type&&(b.bannerImgUrl.push(a.result.images[c].img_url),console.log(b.bannerImageService+a.result.images[c].img_url))}}else WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})}}function k(b){var c="";c=o?$("#selectMbProduct"):$("#selectPcProduct"),c.select2({language:"zh-CN",placeholder:"请输入商品名称",width:"100%",multiple:!0,maximumSelectionLength:1,minimumInputLength:1,tags:!1,allowClear:!1,data:b,ajax:{url:d.productApi+"/biz/0/prodsList?active=1",dataType:"json",delay:250,allowClear:!1,data:function(b){return{name:b.term,tenant:a.tenant}},processResults:function(a,b){for(var c=[],d={id:"T01",text:"标签",element:"HTMLOptGroupElement",children:[]},e={id:"T02",text:"产品",element:"HTMLOptGroupElement",children:[]},f=0;f<a.label.length;f++){var g={id:a.label[f].id,text:a.label[f].label_name};d.children.push(g)}for(var f=0;f<a.prod.length;f++){var g={id:a.prod[f].prod_id,text:a.prod[f].name};e.children.push(g)}return e.children.length>0&&c.push(e),d.children.length>0&&c.push(d),{results:c}},cache:!0},escapeMarkup:function(a){return a},templateSelection:function(a){return window.setTimeout(function(){$(".select2-search__field").val("")},100),a.text}})}a.headerSearch=0,a.headerNav=0,b.category=[],b.recommeds=[],b.bannerList=[],b.bannerImgUrl=[],b.imageService=d.imageApi+"/sizes/m/imageSets/",b.bannerImageService=d.imageApi+"/images/";var l=c.getCookie(c.USER_ID),m=c.getCookie(c.BIZ_ID),n=g.search().zyUser?g.search().zyUser:null;null!=n&&f.saveZyUser(n),initHeaer();var o=checkPlatform();window.setTimeout(function(){OwlCarousel.initOwlCarousel()},1e3),b.categoryClick=function(a){console.log("商品分类Id="+a),window.location.href="indexApp.html#/product_filter/"+a+"/type/1"},c.get(d.productApi+"/tags/1/prodTypes").then(function(a){if(b.category=[],a.result.length>9)for(var c=0;c<9;c++)b.category.push(a.result[c]);else b.category=a.result}).catch(function(a){"NotAuthorized"!=error.code&&ErrorBox("服务器内部错误")}),c.get(d.productApi+"/biz/0/tags/1/prods").then(function(a){a.success?b.recommeds=a.result.slice(0,20):WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=error.code&&ErrorBox("服务器内部错误")}),a.imageSize=function(a){return d.imageApi+"/sizes/"+a+"/imageSets/"};var p=0,q=0;window.onscroll=function(){p=window.scrollY,q=window.scrollX},b.addCollectionClick=function(a){var e={prods:[a.prodId]};c.post(d.productApi+"/favoriteProds",e).then(function(c){c.success?c.result.length>0?c.result[0].success?(b.collections.push(a),Toast("已添加到收藏!")):WarningBox("当前商品已经收藏,请到我的收藏里查看!"):WarningBox("添加收藏失败!"):WarningBox(c.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},b.deleteCollectionClick=function(a){var b={prods:[a.prodId]};c.delete(d.productApi+"/favoriteProds",{data:b}).then(function(a){a.success?h():WarningBox(a.msg)}).catch(function(a){"NotAuthorized"!=a.code&&ErrorBox("服务器内部错误")})},b.ifHasInFavorite=function(a){var c=!1;for(var d in b.collections){b.collections[d].prodId==a&&(c=!0)}return c},b.addShoppingCartClick=function(c,d,e,f){a.prodPush(c,d);var g="#add-cart-btn"+e,h=$(g).offset(),i=a.staticContentURL+"/"+a.tenant+"/assets/images/prodDefault240.jpg";null!=c.imgUrl&&c.imgUrl.length>0&&(i=b.imageService+c.imgUrl);var j=$('<img class="u-flyer" src="'+i+'">');j.css({width:"50px",height:"50px"}),j.fly({start:{left:h.left-q+30,top:h.top-p},end:{left:a.cartOffset.left+10,top:a.cartOffset.top+10,width:0,height:0},onEnd:function(){this.destory()}})},b.bannerLinkToProduct=function(a){var c=b.bannerList[a];c&&(window.location.href="indexApp.html#/product/"+c.prodId+"/bizId/0")},b.home2Search=function(){var a="",b=[];a=$(".select2-search__field").val(),b=o?$("#selectMbProduct").select2("data"):$("#selectPcProduct").select2("data"),a.length>0&&(window.location.href="indexApp.html#/product_filter/"+a+"/type/3"),b.length>0&&(window.location.href="indexApp.html#/product_filter/"+b[0].text+"/type/3")},b.toHome=function(){window.location.href="/"};var r=function(){if(-1!=g.$$url.indexOf("json")){var c=g.$$url.split("=")[1],d=JSON.parse(decodeURIComponent(c)),e=f.getOrderInfo(),h=[];for(var i in d.roomsInfo)""!==d.roomsInfo[i].id&&h.push(d.roomsInfo[i]);d.roomsInfo=h,f.saveOrderInfo(d),void 0==d.orderId?InfoBox("订单号不存在!"):null!==e&&e.orderId!==d.orderId&&(window.setTimeout(function(){a.allNum=0,a.clearCart(),b.$apply()},1e3),window.setTimeout(function(){b.$apply()},2e3)),0==d.roomsInfo.length?InfoBox("空间信息不存在!"):void 0==d.authorization&&InfoBox("Token不存在!")}},s=function(){if(null==l||0==l.length||null==m||0==m.length){if(configLogin(e,"home2"))return}};checkPlatform(),i(),r(),b.$watch("setCookieStatus",function(d,e){!0===a.setCookieStatus?(a.isLogin=!0,a.userName=c.getCookie("username")):-1===g.$$url.indexOf("json")&&s(),console.log("getCookie-isLogin :"+c.getCookie("isLogin")),console.log("time :"+new Date),window.setTimeout(function(){"1"==c.getCookie("isLogin")&&(a.isLogin=!0,a.userName=c.getCookie("username")?c.getCookie("username"):null,b.$apply("isLogin"),b.$apply("userName"))},5e3)}),$(function(){window.setTimeout(function(){k()},100),baiduLinkSubmit(),setPageTitle("","","")})}]),app.controller("homeJccController",["$rootScope","$scope","$httpService","$hostService","$filter","sharedData","$location",function(a,b,c,d,e,f,g){a.headerSearch=0,a.headerNav=0,a.isMobile=!1,a.isMobile=checkPlatform(),b.category=[],b.recommeds=[],b.bannerList=[],b.bannerImgUrl=[],b.imageService=d.imageApi+"/sizes/m/imageSets/",b.bannerImageService=d.imageApi+"/images/",b.showProductType=0;c.getCookie(c.USER_ID),c.getCookie(c.BIZ_ID);b.jjcSearch=function(){var a="";a=$("#jjcProdcutSearch").val(),a.length>0&&(window.location.href="indexApp.html#/product_filter/"+a+"/type/2")},a.$on("$routeChangeSuccess",function(){a.nowPath=g.path()}),b.showLabel=function(){$(".product-label").toggle()},$(document).ready(function(){$("#scrollDiv").Scroll({line:1,speed:500,timer:3e3,up:"but_up",down:"but_down"})})}]);